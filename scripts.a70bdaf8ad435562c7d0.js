!function(){function e(e,t,a,r){var i=e.naturalWidth,n=e.naturalHeight;if(i+n){var o=a.width,s=a.height,c=t.getContext("2d");c.save(),function(e,t,a,r,i){switch(i){case 5:case 6:case 7:case 8:e.width=r,e.height=a;break;default:e.width=a,e.height=r}switch(i){case 2:t.translate(a,0),t.scale(-1,1);break;case 3:t.translate(a,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(a,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-a,0)}}(t,c,o,s,a.orientation),function(e){var t=e.naturalWidth;if(t*e.naturalHeight>1048576){var a=document.createElement("canvas");a.width=a.height=1;var r=a.getContext("2d");return r.drawImage(e,1-t,0),0===r.getImageData(0,0,1,1).data[3]}return!1}(e)&&(i/=2,n/=2);var h=1024,d=document.createElement("canvas");d.width=d.height=h;for(var l=d.getContext("2d"),g=r?function(e,t,a){var r=document.createElement("canvas");r.width=1,r.height=a;var i=r.getContext("2d");i.drawImage(e,0,0);for(var n=i.getImageData(0,0,1,a).data,o=0,s=a,c=a;c>o;)0===n[4*(c-1)+3]?s=c:o=c,c=s+o>>1;var h=c/a;return 0===h?1:h}(e,0,n):1,u=Math.ceil(h*o/i),f=Math.ceil(h*s/n/g),m=0,w=0;m<n;){for(var b=0,v=0;b<i;)l.clearRect(0,0,h,h),l.drawImage(e,-b,-m),c.drawImage(d,0,0,h,h,v,w,u,f),b+=h,v+=u;m+=h,w+=f}c.restore(),d=l=null}}var t=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;function a(e){if(window.Blob&&e instanceof Blob){if(!t)throw Error("No createObjectURL function found to create blob url");var a=new Image;a.src=t.createObjectURL(e),this.blob=e,e=a}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=e.onerror=function(){var e=r.imageLoadListeners;if(e){r.imageLoadListeners=null;for(var t=0,a=e.length;t<a;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}a.prototype.render=function(a,r,i){if(this.imageLoadListeners){var n=this;this.imageLoadListeners.push(function(){n.render(a,r,i)})}else{var o=this.srcImage.naturalWidth,s=this.srcImage.naturalHeight,c=(r=r||{}).width,h=r.height,d=r.maxWidth,l=r.maxHeight,g=!this.blob||"image/jpeg"===this.blob.type;c&&!h?h=s*c/o<<0:h&&!c?c=o*h/s<<0:(c=o,h=s),d&&c>d&&(h=s*(c=d)/o<<0),l&&h>l&&(c=o*(h=l)/s<<0);var u={width:c,height:h};for(var f in r)u[f]=r[f];var m=a.tagName.toLowerCase();"img"===m?a.src=function(t,a,r){var i=document.createElement("canvas");return e(t,i,a,r),i.toDataURL("image/jpeg",a.quality||.8)}(this.srcImage,u,g):"canvas"===m&&e(this.srcImage,a,u,g),"function"==typeof this.onrender&&this.onrender(a),i&&i(),this.blob&&(this.blob=null,t.revokeObjectURL(this.srcImage.src))}},"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof exports?module.exports=a:this.MegaPixImage=a}();